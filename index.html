<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Combat Form</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f2f2f2;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .form-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .top-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .top-buttons button {
      background-color: #ccc;
      color: white;
      padding: 2px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .row label {
      width: 150px;
      font-weight: normal;
      font-size: 14px;
    }

    .row input[type="text"] {
  flex: 0 0 100px;
  height: 28px;
  font-size: 12px;
  padding: 8px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 6px; /* adds rounded corners */
}

    .row .button-group {
      display: flex;
      gap: 10px;
      margin-left: auto;
    }

.row button {
  flex: 0 0 auto;
  padding: 6px 12px;
  font-size: 14px;
  background-color: #ccc;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* Push buttons to right */
.row button:first-of-type {
  margin-left: auto;
}
  
    .section-divider {
  margin: 40px 0 20px;
  text-align: center;
  position: relative;
  font-size: 16px;
  color: #666;
}

.section-divider::before,
.section-divider::after {
  content: "";
  position: absolute;
  top: 50%;
  width: 40%;
  height: 1px;
  background: #ccc;
}

.section-divider::before {
  left: 0;
}

.section-divider::after {
  right: 0;
}

.row select {
  padding: px;
  font-size: 14px;
  border-radius: 6px;
}

#kaiDisciplinesSection .row label {
  display: inline-block;
  width: 20px;       /* or 16px, depending on spacing you want */
  margin-right: 10px;
  font-weight: normal;
  font-size: 14px;
  text-align: right; /* optional: aligns number nicely */
}

.short-label {
  flex: 0 0 30px;       /* fix width like numeric labels */
  font-weight: normal;  /* remove bold */
  font-size: 14px;      /* smaller font size */
  white-space: nowrap;  /* prevent wrapping */
}

button:disabled {
  background-color: #ccc;    /* light gray background */
  color: #666;               /* dark gray text */
  cursor: not-allowed;       /* show a ‚Äúno‚Äù cursor */
  opacity: 0.6;              /* make it slightly transparent */
  box-shadow: none;          /* remove any shadow or highlights */
}

#discoveredItem {
  flex-grow: 0 !important;     /* prevent growing */
  flex-shrink: 0 !important;   /* prevent shrinking */
  flex-basis: 250px !important; /* set fixed base width */
  max-width: 250px !important;  /* max width to keep it short */
  width: 250px !important;      /* fallback width */
}

.section-label {
  font-weight: normal;
  font-size: 14px; /* Adjust to match your other label size */
  display: block;
  margin-bottom: 10px;
}


.backpack-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px 20px;
}

.backpack-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.backpack-item label {
  width: 20px;
  text-align: right;
  font-weight: normal;
  font-size: 14px; /* Match other label font size */
}


.backpack-item input {
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 6px 8px;
  font-size: 16px;
  flex: 1 1 200px; /* Minimum width of 200px, will grow if space allows */
}




  </style>
</head>
<body>
  <div class="form-container">
    <div class="top-buttons">
      <button onclick="loadForm()">Load form</button>
      <button onclick="saveForm()">Save form</button>
      <button type="button" onclick="resetForm()">Reset form</button>
    </div>

    <form id="characterForm">
      <!-- Combat Skill Row -->
      <div class="section-divider">Combat</div>
      <div class="row">
        <label for="combatSkill">Combat Skill</label>
        <input type="text" id="combatSkill" name="combatSkill" oninput="updateTotalCombatSkill()">
        <div class="button-group">
          <button type="button" onclick="randomizeCombatSkill()">Randomize Combat Skill</button>
        </div>
      </div>

      <!-- Combat Skill Bonus Row -->
      <div class="row">
        <label for="combatSkillBonus">Combat Skill Bonus</label>
       <input type="text" id="combatSkillBonus" name="combatSkillBonus" value="0" oninput="updateTotalCombatSkill()">
        <div class="button-group">
          <button type="button" onclick="adjustCombatSkillBonus(-1)">-1</button>
          <button type="button" onclick="adjustCombatSkillBonus(1)">+1</button>
        </div>
      </div>
      
      <!-- Total Combat Skill Row -->
<div class="row">
  <label for="totalCombatSkill">Total Combat Skill</label>
<input type="text" id="totalCombatSkill" name="totalCombatSkill" readonly>
  <div class="button-group">
    <button type="button" onclick="resetCombatFields()">Reset</button>
  </div>
</div>
<div class="section-divider">Endurance</div>

<!-- Endurance Points Row -->
<div class="row">
  <label for="endurancePoints">Endurance Points</label>
  <input type="text" id="endurancePoints" name="endurancePoints" oninput="updateTotalEndurancePoints()">
  <div class="button-group">
    <button type="button" onclick="randomizeEndurancePoints()">Randomize Endurance Points</button>
  </div>
</div>

<!-- Endurance Bonus Row -->
<div class="row">
  <label for="enduranceBonus">Endurance Bonus</label>
  <input type="text" id="enduranceBonus" name="enduranceBonus" value="0" oninput="updateTotalEndurancePoints()">
  <div class="button-group">
    <button type="button" onclick="adjustEnduranceBonus(-1)">-1</button>
    <button type="button" onclick="adjustEnduranceBonus(1)">+1</button>
  </div>
</div>

<!-- Total Endurance Points Row -->
<div class="row">
  <label for="totalEndurancePoints">Total Endurance Points</label>
  <input type="text" id="totalEndurancePoints" name="totalEndurancePoints" readonly>
  <div class="button-group">
    <button type="button" onclick="resetEnduranceFields()">Reset</button>
  </div>
</div>

<div class="section-divider">Kai Disciplines</div>



<!-- Dropdowns -->
<!-- Kai Disciplines Section -->
<div id="kaiDisciplinesSection">
  <div class="row">
    <label for="discipline1">1.</label>
    <select id="discipline1" name="discipline1">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>

    <!-- Randomize Button in same row -->
    <div style="margin-left: auto;">
      <button type="button" onclick="randomizeKaiDisciplines()">Randomize Kai Disciplines</button>
    </div>
  </div>

  <div class="row">
    <label for="discipline2">2.</label>
    <select id="discipline2" name="discipline2">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
  <div class="row">
    <label for="discipline3">3.</label>
    <select id="discipline3" name="discipline3">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
  <div class="row">
    <label for="discipline4">4.</label>
<select id="discipline4" name="discipline4">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
  <div class="row">
    <label for="discipline5">5.</label>
<select id="discipline5" name="discipline5">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
</div>

<div class="section-divider">Weapons</div>

<div class="section">
  <div class="row">
   <label for="leftHand" class="short-label">Left Hand</label>
    <select id="leftHand" name="leftHand">
      <option>None</option>
      <option>Dagger</option>
      <option>Spear</option>
      <option>Mace</option>
      <option>Short Sword</option>
      <option>Warhammer</option>
      <option selected>Axe</option>
      <option>Sword</option>
      <option>Quarterstaff</option>
      <option>Broadsword</option>
    </select>

<label for="rightHand" class="short-label" style="margin-left:20px;">Right Hand</label>
    <select id="rightHand" name="rightHand">
      <option selected>None</option>
      <option>Dagger</option>
      <option>Spear</option>
      <option>Mace</option>
      <option>Short Sword</option>
      <option>Warhammer</option>
      <option>Axe</option>
      <option>Sword</option>
      <option>Quarterstaff</option>
      <option>Broadsword</option>
    </select>
  </div>
</div>

<div class="row" id="weaponskillRow">
  <label for="weaponskillField" class="short-label">Weaponskill in:</label>
  <input type="text" id="weaponskillField" name="weaponskillField" readonly>
  <button id="randomizeWeaponskillBtn" type="button" disabled>Randomize Weaponskill</button>
</div>

<div class="section-divider">Equipment</div>

<div class="row">
  <label for="beltPouchGold">Belt Pouch (Gold):</label>
  <input type="text" id="beltPouchGold" name="beltPouchGold" value="" />
  <button type="button" id="randomizeGoldBtn">Randomize Starting Gold</button>
</div>

<div class="row">
  <label for="meals">Meals</label>
  <input type="text" id="meals" name="meals" value="1" />
  <button type="button" id="decreaseMealsBtn">-1</button>
  <button type="button" id="increaseMealsBtn">+1</button>
</div>

<div class="row">
  <label for="discoveredItem">Discovered Item</label>
  <input type="text" id="discoveredItem" name="discoveredItem" />
  <button type="button" id="randomizeDiscoveredItemBtn">Randomize Discovered Item</button>
</div>

<div class="section">
  <label class="section-label">Backpack Items</label>
  <div class="backpack-grid">
    <div class="backpack-item"><label>1.</label><input type="text" name="backpack1"></div>
    <div class="backpack-item"><label>2.</label><input type="text" name="backpack2"></div>
    <div class="backpack-item"><label>3.</label><input type="text" name="backpack3"></div>
    <div class="backpack-item"><label>4.</label><input type="text" name="backpack4"></div>
    <div class="backpack-item"><label>5.</label><input type="text" name="backpack5"></div>
    <div class="backpack-item"><label>6.</label><input type="text" name="backpack6"></div>
    <div class="backpack-item"><label>7.</label><input type="text" name="backpack7"></div>
    <div class="backpack-item"><label>8.</label><input type="text" name="backpack8"></div>
  </div>
</div>


    </form>
  </div>

  <script>
    function randomizeCombatSkill() {
  const min = 10;
  const max = 19;
  const value = Math.floor(Math.random() * (max - min + 1)) + min;
  document.getElementById('combatSkill').value = value;
  updateTotalCombatSkill();
}

  function adjustCombatSkillBonus(delta) {
  const field = document.getElementById('combatSkillBonus');
  let value = parseInt(field.value) || 0;
  field.value = value + delta;
  updateTotalCombatSkill();
}

    function saveForm() {
      const form = document.getElementById('characterForm');
      const data = new FormData(form);
      const lines = [];
      for (let [key, value] of data.entries()) {
        lines.push(`${key}=${value}`);
      }
      const blob = new Blob([lines.join('\n')], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'form.txt';
      link.click();
      URL.revokeObjectURL(link.href);
    }

function loadForm() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.txt';

  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = event => {
      const lines = event.target.result.split('\n');
      for (let line of lines) {
        const [key, value] = line.split('=');
        const field = document.querySelector(`[name="${key}"]`);
        if (field) field.value = value;
      }
      updateTotalCombatSkill(); // üëà recalculate total after loading
    };
    reader.readAsText(file);
  };

  input.click();
}

function resetForm() {
  const form = document.getElementById('characterForm');
  form.reset();

  // Reset discipline selects and re-enable all options
  for (let i = 1; i <= 5; i++) {
    const select = document.getElementById(`discipline${i}`);
    select.value = "-- Select Discipline --";

    for (let option of select.options) {
      option.disabled = false;
    }
  }

  if (typeof updateAvailableOptions === "function") {
    updateAvailableOptions();
  }

  // Reset the "Weaponskill in" field to "-"
  document.getElementById("weaponskillField").value = "-";

  setTimeout(() => {
    updateWeaponskillButtonState();
  }, 50);
}




    function resetCombatFields() {
  document.getElementById('combatSkill').value = '';
  document.getElementById('combatSkillBonus').value = '0';
  document.getElementById('totalCombatSkill').value = '';
}
function updateTotalCombatSkill() {
  const skill = parseInt(document.getElementById('combatSkill').value) || 0;
  const bonus = parseInt(document.getElementById('combatSkillBonus').value) || 0;
  document.getElementById('totalCombatSkill').value = skill + bonus;
}

   function randomizeEndurancePoints() {
  const min = 20;
  const max = 29;
  const value = Math.floor(Math.random() * (max - min + 1)) + min;
  document.getElementById('endurancePoints').value = value;
  updateTotalEndurancePoints();
}

function adjustEnduranceBonus(delta) {
  const field = document.getElementById('enduranceBonus');
  let value = parseInt(field.value) || 0;
  field.value = value + delta;
  updateTotalEndurancePoints();
}

function updateTotalEndurancePoints() {
  const points = parseInt(document.getElementById('endurancePoints').value) || 0;
  const bonus = parseInt(document.getElementById('enduranceBonus').value) || 0;
  document.getElementById('totalEndurancePoints').value = points + bonus;
}

function resetEnduranceFields() {
  document.getElementById('endurancePoints').value = '';
  document.getElementById('enduranceBonus').value = '0';
  document.getElementById('totalEndurancePoints').value = '';
}

  const disciplines = [
    "Camouflage",
    "Hunting - No need for a meal when instructed to eat",
    "Sixth Sense",
    "Healing - +1 Endurance point for each section without combat",
    "Weaponskill - +2 points to Combat skill when carrying skill weapon",
    "Mindshield - No points lost when attacked by Mindblast",
    "Mindblast - +2 Combat Skill points",
    "Animal Kinship",
    "Mind Over Matter"
  ];

  function updateAvailableOptions() {
    const selects = document.querySelectorAll('#kaiDisciplinesSection select');
    const selectedValues = Array.from(selects).map(select => select.value);

    selects.forEach(select => {
      const options = select.querySelectorAll('option');
      options.forEach(option => {
        if (
          selectedValues.includes(option.value) &&
          option.value !== "-- Select Discipline --" &&
          select.value !== option.value
        ) {
          option.disabled = true;
        } else {
          option.disabled = false;
        }
      });
    });
  }

  function randomizeKaiDisciplines() {
    const availableDisciplines = [...disciplines];
    const shuffled = [];

    for (let i = 0; i < 5; i++) {
      const randomIndex = Math.floor(Math.random() * availableDisciplines.length);
      shuffled.push(availableDisciplines[randomIndex]);
      availableDisciplines.splice(randomIndex, 1);
    }

    for (let i = 1; i <= 5; i++) {
      const select = document.getElementById(`discipline${i}`);
      select.value = shuffled[i - 1];
    }

    updateAvailableOptions();
    checkWeaponskillSelected();
    updateWeaponskillButtonState(); // <--- call this here!
  }

  // Attach change listeners when page loads
  window.addEventListener('DOMContentLoaded', () => {
    const selects = document.querySelectorAll('#kaiDisciplinesSection select');
    selects.forEach(select => {
      select.addEventListener('change', updateAvailableOptions);
    });
    updateAvailableOptions(); // Initial setup
  });

const weaponskillOptions = [
  "Dagger",
  "Spear",
  "Mace",
  "Short Sword",
  "Warhammer",
  "Sword",
  "Axe",
  "Sword",
  "Quarterstaff",
  "Broadsword"
];

const weaponskillButton = document.getElementById('randomizeWeaponskillBtn');
const weaponskillField = document.getElementById('weaponskillField');

function checkWeaponskillSelected() {
  const selects = document.querySelectorAll('#kaiDisciplinesSection select');
  let enabled = false;
  selects.forEach(select => {
    if (select.value === "Weaponskill - +2 points to Combat skill when carrying skill weapon") {
      enabled = true;
    }
  });
  weaponskillButton.disabled = !enabled;
}

// Randomize weapon and update text field
function randomizeWeaponskill() {
  console.log('Randomize Weaponskill button clicked');
  const randomIndex = Math.floor(Math.random() * weaponskillOptions.length);
  const weapon = weaponskillOptions[randomIndex];
  console.log('Selected weapon:', weapon);
  weaponskillField.value = weapon;
}


// Attach event listeners
window.addEventListener('DOMContentLoaded', () => {
  // Check initially
  checkWeaponskillSelected();

  // Add change event listeners to disciplines dropdowns
  const selects = document.querySelectorAll('#kaiDisciplinesSection select');
  selects.forEach(select => {
    select.addEventListener('change', checkWeaponskillSelected);
  });

  // Button click listener
  weaponskillButton.addEventListener('click', randomizeWeaponskill);
});

document.getElementById('randomizeGoldBtn').addEventListener('click', () => {
  const goldField = document.getElementById('beltPouchGold');
  const randomGold = Math.floor(Math.random() * 10); // 0 to 9
  goldField.value = randomGold;
});

const mealsInput = document.getElementById('meals');
const decreaseMealsBtn = document.getElementById('decreaseMealsBtn');
const increaseMealsBtn = document.getElementById('increaseMealsBtn');

decreaseMealsBtn.addEventListener('click', () => {
  let currentValue = parseInt(mealsInput.value) || 0;
  if (currentValue > 0) {  // optionally prevent negative values
    mealsInput.value = currentValue - 1;
  }
});

increaseMealsBtn.addEventListener('click', () => {
  let currentValue = parseInt(mealsInput.value) || 0;
  mealsInput.value = currentValue + 1;
});

const discoveredItems = [
  "Sword",
  "Helmet (+2 Endurance Bonus)",
  "Two Meals",
  "Chainmail Waistcoat (+4 Endurance Bonus)",
  "Mace",
  "Healing Potion (+4 Endurance when used)",
  "Quarterstaff",
  "Spear",
  "12 Gold Crowns",
  "Broadsword"
];

document.getElementById('randomizeDiscoveredItemBtn').addEventListener('click', () => {
  const randomIndex = Math.floor(Math.random() * discoveredItems.length);
  document.getElementById('discoveredItem').value = discoveredItems[randomIndex];
});

function updateWeaponskillButtonState() {
  const disciplines = [];
  for (let i = 1; i <= 5; i++) {
    disciplines.push(document.getElementById(`discipline${i}`).value);
  }
  const hasWeaponskill = disciplines.includes("Weaponskill - +2 points to Combat skill when carrying skill weapon");
  
  document.getElementById("randomizeWeaponskillBtn").disabled = !hasWeaponskill;
  
  if (!hasWeaponskill) {
    document.getElementById("weaponskillField").value = "-";
  }
}

for (let i = 1; i <= 5; i++) {
  const select = document.getElementById(`discipline${i}`);
  select.addEventListener('change', updateWeaponskillButtonState);
}





  </script>
</body>
</html>
