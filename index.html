<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Combat Form</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f2f2f2;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .form-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .top-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .top-buttons button {
      background-color: #ccc;
      color: white;
      padding: 2px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }



.button-input-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.button-input-row .left-buttons {
  display: flex;
  gap: 8px;
}

.button-input-row .right-input {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-left: auto;
}

.button-input-row button {
  flex: 0 0 auto;
  padding: 6px 12px;
  font-size: 14px;
  background-color: #ccc;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.button-input-row input[type="text"] {
  flex: 0 0 100px;
  height: 28px;
  font-size: 12px;
  padding: 8px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 6px;
}

.button-input-row label {
  width: 150px;
  font-weight: normal;
  font-size: 14px;
  display: inline-block;
  text-align: right;
}

    .row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .row label {
      width: 150px;
      font-weight: normal;
      font-size: 14px;
    }

    .row input[type="text"] {
  flex: 0 0 100px;
  height: 28px;
  font-size: 12px;
  padding: 8px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 6px; /* adds rounded corners */
}

    .row .button-group {
      display: flex;
      gap: 10px;
      margin-left: auto;
    }

.row button {
  flex: 0 0 auto;
  padding: 6px 12px;
  font-size: 14px;
  background-color: #ccc;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* Push buttons to right */
.row button:first-of-type {
  margin-left: auto;
}
  
    .section-divider {
  margin: 40px 0 20px;
  text-align: center;
  position: relative;
  font-size: 16px;
  color: #666;
}

.section-divider::before,
.section-divider::after {
  content: "";
  position: absolute;
  top: 50%;
  width: 40%;
  height: 1px;
  background: #ccc;
}

.section-divider::before {
  left: 0;
}

.section-divider::after {
  right: 0;
}

.row select {
  padding: px;
  font-size: 14px;
  border-radius: 6px;
}

#kaiDisciplinesSection .row label {
  display: inline-block;
  width: 20px;       /* or 16px, depending on spacing you want */
  margin-right: 10px;
  font-weight: normal;
  font-size: 14px;
  text-align: right; /* optional: aligns number nicely */
}

.short-label {
  flex: 0 0 30px;       /* fix width like numeric labels */
  font-weight: normal;  /* remove bold */
  font-size: 14px;      /* smaller font size */
  white-space: nowrap;  /* prevent wrapping */
}

button:disabled {
  background-color: #ccc;    /* light gray background */
  color: #666;               /* dark gray text */
  cursor: not-allowed;       /* show a ‚Äúno‚Äù cursor */
  opacity: 0.6;              /* make it slightly transparent */
  box-shadow: none;          /* remove any shadow or highlights */
}

#discoveredItem {
  flex-grow: 0 !important;     /* prevent growing */
  flex-shrink: 0 !important;   /* prevent shrinking */
  flex-basis: 250px !important; /* set fixed base width */
  max-width: 250px !important;  /* max width to keep it short */
  width: 250px !important;      /* fallback width */
}

.section-label {
  display: block;
  font-size: 14px;
  margin-top: 20px; /* ‚Üê Increase this value as needed */
  margin-bottom: 10px;
}


.backpack-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px 20px;
}

.backpack-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.backpack-item label {
  width: 20px;
  text-align: right;
  font-weight: normal;
  font-size: 14px; /* Match other label font size */
}


.backpack-item input {
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 6px 8px;
  font-size: 14px;
  flex: 1 1 200px; /* Minimum width of 200px, will grow if space allows */
}

/* Match label and input spacing */
#combat-container label {
  width: 180px;
  display: inline-block;
  font-weight: normal;
}

#combat-container input[type="number"] {
  width: 100px;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

#combat-container button {
  padding: 6px 12px;
  font-size: 14px;
  margin-top: 8px;
}

.combat-log {
  margin-top: 1em;
  padding: 10px;
  border: 1px solid #ccc;
  white-space: pre-line;
  border-radius: 5px;
  font-size: 14px; /* or whatever size you want */
  background-color: #f9f9f9;
}

#combat-container .row {
  margin-bottom: 0.5em;
  display: flex;
  align-items: center;
}

#combat-container {
  margin-top: 1em;
}

.special-grid {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.special-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.special-item label {
  font-weight: normal;
  font-size: 14px;
  white-space: nowrap;
}

.special-item input {
  flex: 1;
  min-width: 120px;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 6px 8px;
  font-size: 14px;
}

.message-text {
  font-size: 0.7em;       /* Smaller font (80% of normal size) */
  color: #d9534f;         /* A nice red color for warnings/messages */
  margin-left: 8px;       /* Some spacing from the field */
  font-weight: 400;       /* Slightly bold for emphasis */
  font-family: Arial, sans-serif; /* Optional: choose a clean font */
}

.notes-container {
  width: 100%;
  margin-top: 1em;
  display: flex;
  flex-direction: column;
}

.notes-container textarea {
  width: 100%;
  min-height: 80px;
  overflow: hidden; /* no scrollbar */
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  font-family: inherit; /* matches other text fields */
  box-sizing: border-box;
  background-color: #fff;
  resize: none; /* no manual resizing */
}

  </style>
</head>
<body>
  <div class="form-container">

    <form id="characterForm">
    
   <div class="button-input-row">
     <div class="left-buttons">
        <button type="button" onclick="loadForm()">Load form</button>
        <button type="button" onclick="saveForm()">Save form</button>
        <button type="button" id="restformbtn" onclick="resetForm()">Reset form</button>
        <button type="button" id="lockRandomizeBtn">Lock Form</button>
     </div>
     <div class="right-input">
        <label for="startSection">Start of Section:</label>
        <input type="text" id="startSection" name="startSection" />
     </div>
   </div>
        
        
      <!-- Combat Skill Row -->
      <div class="section-divider">Combat</div>
      <div class="row">
        <label for="combatSkill">Base Combat Skill</label>
        <input type="text" id="combatSkill" name="combatSkill" readonly oninput="updateTotalCombatSkill()">
        <div class="button-group">
          <button type="button" onclick="randomizeCombatSkill()">Randomize Combat Skill</button>
        </div>
      </div>

      <!-- Combat Skill Bonus Row -->
      <div class="row">
        <label for="combatSkillBonus">Combat Skill Bonus</label>
       <input type="text" id="combatSkillBonus" name="combatSkillBonus" readonly value="0" oninput="updateTotalCombatSkill()">
        <div class="button-group">
          <button type="button" onclick="adjustCombatSkillBonus(-1)">-1</button>
          <button type="button" onclick="adjustCombatSkillBonus(1)">+1</button>
        </div>
      </div>
      
      <!-- Total Combat Skill Row -->
<div class="row">
  <label for="totalCombatSkill">Total Combat Skill</label>
<input type="text" id="totalCombatSkill" name="totalCombatSkill" readonly>
  <div class="button-group">
    <button type="button" id="resetCombatBtn" onclick="resetCombatFields()">Reset</button>
  </div>
</div>
<div class="section-divider">Endurance</div>

<!-- Endurance Points Row -->
<div class="row">
  <label for="endurancePoints">Base Endurance Points</label>
  <input type="text" id="endurancePoints" name="endurancePoints" readonly oninput="updateTotalEndurancePoints()">
  <div class="button-group">
    <button type="button" onclick="randomizeEndurancePoints()">Randomize Endurance Points</button>
  </div>
</div>

<!-- Endurance Bonus Row -->
<div class="row">
  <label for="enduranceBonus">Endurance Bonus</label>
  <input type="text" id="enduranceBonus" name="enduranceBonus" readonly value="0" oninput="updateTotalEndurancePoints()">
  <span id="enduranceBonusMessage" class="message-text"></span>
  <div class="button-group">
    <button type="button" onclick="adjustEnduranceBonus(-1)">-1</button>
    <button type="button" onclick="adjustEnduranceBonus(1)">+1</button>
  </div>
</div>

<!-- Total Endurance Points Row -->
<div class="row">
  <label for="totalEndurancePoints">Total Endurance Points</label>
  <input type="text" id="totalEndurancePoints" name="totalEndurancePoints" readonly>
  <div class="button-group">
    <button type="button" id="resetEnduranceBtn" onclick="resetEnduranceFields()">Reset</button>
  </div>
</div>

<!-- Current Endurance Points Row -->
<div class="row">
  <label for="currentEndurancePoints">Endurance Points</label>
  <input type="text" id="currentEndurancePoints" name="currentEndurancePoints" readonly>
  <div class="button-group">
    <button type="button" onclick="adjustCurrentEndurancePoints(-1)">-1</button>
    <button type="button" onclick="adjustCurrentEndurancePoints(1)">+1</button>
  </div>
</div>

<div class="section-divider">Kai Disciplines</div>



<!-- Dropdowns -->
<!-- Kai Disciplines Section -->
<div id="kaiDisciplinesSection">
  <div class="row">
    <label for="discipline1">1.</label>
    <select id="discipline1" name="discipline1" class="discipline-field">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>

    <!-- Randomize Button in same row -->
    <div style="margin-left: auto;">
      <button type="button" onclick="randomizeKaiDisciplines()">Randomize Kai Disciplines</button>
    </div>
  </div>

  <div class="row">
    <label for="discipline2">2.</label>
    <select id="discipline2" name="discipline2" class="discipline-field">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
  <div class="row">
    <label for="discipline3">3.</label>
    <select id="discipline3" name="discipline3" class="discipline-field">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
  <div class="row">
    <label for="discipline4">4.</label>
    <select id="discipline4" name="discipline4" class="discipline-field">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
  <div class="row">
    <label for="discipline5">5.</label>
    <select id="discipline5" name="discipline5" class="discipline-field">
    <option>-- Select Discipline --</option>
    <option>Camouflage</option>
    <option>Hunting - No need for a meal when instructed to eat</option>
    <option>Sixth Sense</option>
    <option>Healing - +1 Endurance point for each section without combat</option>
    <option>Weaponskill - +2 points to Combat skill when carrying skill weapon</option>
    <option>Mindshield - No points lost when attacked by Mindblast</option>
    <option>Mindblast - +2 Combat Skill points</option>
    <option>Animal Kinship</option>
    <option>Mind Over Matter</option>
  </select>
  </div>
</div>

<span id="mindblastMessage" class="message-text"></span>

<div class="section-divider">Weapons</div>

<div class="section">
  <div class="row">
   <label for="leftHand" class="short-label">Left Hand</label>
    <select id="leftHand" name="leftHand">
      <option>None</option>
      <option>Dagger</option>
      <option>Spear</option>
      <option>Mace</option>
      <option>Short Sword</option>
      <option>Warhammer</option>
      <option selected>Axe</option>
      <option>Sword</option>
      <option>Quarterstaff</option>
      <option>Broadsword</option>
    </select>

<label for="rightHand" class="short-label" style="margin-left:20px;">Right Hand</label>
    <select id="rightHand" name="rightHand">
      <option selected>None</option>
      <option>Dagger</option>
      <option>Spear</option>
      <option>Mace</option>
      <option>Short Sword</option>
      <option>Warhammer</option>
      <option>Axe</option>
      <option>Sword</option>
      <option>Quarterstaff</option>
      <option>Broadsword</option>
    </select>
    <span id="unarmedMessage" class="message-text"></span>  <!-- message for unarmed -->
  </div>
</div>



<div class="row" id="weaponskillRow">
  <label for="weaponskillField" class="short-label">Weaponskill in:</label>
  <input type="text" id="weaponskillField" name="weaponskillField" readonly>
  <span id="weaponskillMessage" class="message-text"></span> <!-- message for weaponskill bonus -->
  <button id="randomizeWeaponskillBtn" type="button" disabled>Randomize Weaponskill</button>
</div>

<div class="section-divider">Equipment</div>

<div class="row">
  <label for="beltPouchGold">Belt Pouch (Gold):</label>
  <input type="text" id="beltPouchGold" name="beltPouchGold" readonly value="" />
    <button type="button" id="decreaseGold">-1</button>
    <button type="button" id="increaseGold">+1</button>
  <button type="button" id="randomizeGoldBtn">Randomize Starting Gold</button>
</div>

<div class="row">
  <label for="meals">Meals</label>
  <input type="text" id="meals" name="meals" readonly value="1" />
  <span id="mealsWarning" class="message-text" style="display: none;">
  No meals, you will lose 3 EP if instructed to eat
</span>
  <button type="button" id="decreaseMealsBtn">-1</button>
  <button type="button" id="increaseMealsBtn">+1</button>
</div>

<div class="row">
  <label for="discoveredItem">Discovered Item</label>
  <input type="text" id="discoveredItem" name="discoveredItem" />
  <button type="button" id="randomizeDiscoveredItemBtn">Randomize Discovered Item</button>
</div>

<div class="section">
  <label class="section-label">Backpack Items</label>
  <div class="backpack-grid">
    <div class="backpack-item"><label>1.</label><input type="text" name="backpack1" value="Meal"></div>
    <div class="backpack-item"><label>2.</label><input type="text" name="backpack2"></div>
    <div class="backpack-item"><label>3.</label><input type="text" name="backpack3"></div>
    <div class="backpack-item"><label>4.</label><input type="text" name="backpack4"></div>
    <div class="backpack-item"><label>5.</label><input type="text" name="backpack5"></div>
    <div class="backpack-item"><label>6.</label><input type="text" name="backpack6"></div>
    <div class="backpack-item"><label>7.</label><input type="text" name="backpack7"></div>
    <div class="backpack-item"><label>8.</label><input type="text" name="backpack8"></div>
  </div>
</div>

<div class="section">
  <label class="section-label">Special Items</label>
  <div class="special-grid">
    <div class="special-item"><label>1.</label><input type="text" name="specialItem1" value="Map"><label>Effect:</label><input type="text" name="specialEffect1"></div>
    <div class="special-item"><label>2.</label><input type="text" name="specialItem2"><label>Effect:</label><input type="text" name="specialEffect2"></div>
    <div class="special-item"><label>3.</label><input type="text" name="specialItem3"><label>Effect:</label><input type="text" name="specialEffect3"></div>
    <div class="special-item"><label>4.</label><input type="text" name="specialItem4"><label>Effect:</label><input type="text" name="specialEffect4"></div>
    <div class="special-item"><label>5.</label><input type="text" name="specialItem5"><label>Effect:</label><input type="text" name="specialEffect5"></div>
    <div class="special-item"><label>6.</label><input type="text" name="specialItem6"><label>Effect:</label><input type="text" name="specialEffect6"></div>
    <div class="special-item"><label>7.</label><input type="text" name="specialItem7"><label>Effect:</label><input type="text" name="specialEffect7"></div>
    <div class="special-item"><label>8.</label><input type="text" name="specialItem8"><label>Effect:</label><input type="text" name="specialEffect8"></div>
    <div class="special-item"><label>9.</label><input type="text" name="specialItem9"><label>Effect:</label><input type="text" name="specialEffect9"></div>
    <div class="special-item"><label>10.</label><input type="text" name="specialItem10"><label>Effect:</label><input type="text" name="specialEffect10"></div>
    <div class="special-item"><label>11.</label><input type="text" name="specialItem11"><label>Effect:</label><input type="text" name="specialEffect11"></div>
    <div class="special-item"><label>12.</label><input type="text" name="specialItem12"><label>Effect:</label><input type="text" name="specialEffect12"></div>
  </div>
</div>
<div class="section-divider">Notes</div>

<div class="notes-container">
  <textarea id="notes" name="notes" rows="4" placeholder=""></textarea>
</div>


<div class="section-divider">Combat</div>

<div class="form-section" id="combat-container">

  <div class="row align-items">
    <label for="playerCS">Player Combat Skill:</label>
    <input type="text" id="playerCS" readonly name="playerCS" />
    <button type="button" onclick="resetCombat()">New Combat</button>
  </div>

  <div class="row">
    <label for="playerEND">Player Endurance:</label>
    <input type="text" id="playerEND" readonly name="playerEND" />
  
  <button type="button" onclick="fightRound()" id="fightBtn">To Combat!!!</button>
  </div>

  <div class="row">
    <label for="enemyCS">Enemy Combat Skill:</label>
    <input type="text" id="enemyCS" name="enemyCS" />
  </div>

  <div class="row">
    <label for="enemyEND">Enemy Endurance:</label>
    <input type="text" id="enemyEND" name="enemyEND" />
  </div>

  <div id="combat-log" class="combat-log"></div>
</div>

    </form>
  </div>

  <script>
      
    let lastUnarmedBonus = 0;
    let lastWeaponskillBonus = 0;
    let lastMindblastBonus = 0;
    let lastHelmetBonus = 0;
    let lastChainmailBonus = 0;
    let lastEnduranceBonus = 0;
    
function resetBonusTrackers() {
  lastUnarmedBonus = 0;
  lastWeaponskillBonus = 0;
  lastMindblastBonus = 0;
  lastHelmetBonus = 0;
  lastChainmailBonus = 0;
  lastEnduranceBonus = 0;
}


      
    function randomizeCombatSkill() {
  const min = 10;
  const max = 19;
  const value = Math.floor(Math.random() * (max - min + 1)) + min;
  document.getElementById('combatSkill').value = value;
  updateTotalCombatSkill();
}

  function adjustCombatSkillBonus(delta) {
  const field = document.getElementById('combatSkillBonus');
  let value = parseInt(field.value) || 0;
  field.value = value + delta;
  updateTotalCombatSkill();
}

    function saveForm() {
  const form = document.getElementById('characterForm');

  // Step 1: Temporarily enable disabled elements (especially selects)
  const previouslyDisabled = [];
  const allFormElements = form.querySelectorAll('[disabled]');
  allFormElements.forEach(el => {
    previouslyDisabled.push(el);
    el.disabled = false;
  });

  // Step 2: Collect form data
  const data = new FormData(form);
  const lines = [];

for (let [key, value] of data.entries()) {
  value = value.replace(/\n/g, '\\n');
  lines.push(`${key}=${value}`);
}

  // Save randomize lock state (if applicable)
  lines.push(`randomizeLocked=${randomizeLocked}`);

  const blob = new Blob([lines.join('\n')], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'form.txt';
  link.click();
  URL.revokeObjectURL(link.href);

  // Step 3: Restore disabled state
  previouslyDisabled.forEach(el => el.disabled = true);
}

function loadForm() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.txt';

  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = event => {
      const lines = event.target.result.split('\n');

      // Reset bonus tracking variables
      lastEnduranceBonus = 0;
      lastCombatSkillBonus = 0;

      // Clear any old messages
      const enduranceMsg = document.getElementById('enduranceBonusMessage');
      if (enduranceMsg) enduranceMsg.textContent = '';
      const combatMsg = document.getElementById('combatBonusMessage');
      if (combatMsg) combatMsg.textContent = '';

      // Load data into form fields and apply special cases
for (let line of lines) {
  const [key, ...rest] = line.split('=');
  const value = rest.join('=');

  if (key === "randomizeLocked") {
    setRandomizeLockState(value === "true");
  } else {
    const field = document.querySelector(`[name="${key}"]`);
    if (field) {
      field.value = value.replace(/\\n/g, '\n');
      if (field.tagName.toLowerCase() === 'textarea') {
        autoResizeTextarea(field);
      }
    }
  }
}
      // Recalculate bonuses
      const discoveredItem = document.getElementById('discoveredItem').value.trim();
      updateEnduranceBonusMessage(discoveredItem);
      updateCombatSkillMessages();
      updateWeaponskillButtonState();
      checkMeals();
    };

    reader.readAsText(file);
  };

  input.click();
}

function resetForm() {
    
     // Unlock everything when resetting
  if (typeof setRandomizeLockState === "function") {
    setRandomizeLockState(false);
  }
    document.getElementById('startSection').value = '';
  const form = document.getElementById('characterForm');
  form.reset();

  // Clear combat log
  document.getElementById('combat-log').innerText = '';

  // Clear specific fields
  ['playerCS', 'playerEND', 'enemyCS', 'enemyEND'].forEach(id => {
    const field = document.getElementById(id);
    if (field) field.value = '';
  });

  // Reset discipline selects and re-enable all options
  for (let i = 1; i <= 5; i++) {
    const select = document.getElementById(`discipline${i}`);
    select.value = "-- Select Discipline --";
    for (let option of select.options) {
      option.disabled = false;
    }
  }

  if (typeof updateAvailableOptions === "function") {
    updateAvailableOptions();
  }

// Reset the notes textarea height to default (empty string)
  const notes = document.getElementById('notes');
  if (notes) {
    notes.value = '';            // Clear notes (if your reset clears it)
    notes.style.height = '';     // Reset height back to default
  }


  // Reset weaponskill field
  document.getElementById("weaponskillField").value = "-";

  setTimeout(() => {
    updateWeaponskillButtonState();
  }, 50);
  document.getElementById("unarmedMessage").textContent = "";
document.getElementById("weaponskillMessage").textContent = "";
document.getElementById("mindblastMessage").textContent = "";
resetBonusTrackers();
document.getElementById("enduranceBonus").value = "0";
document.getElementById("enduranceBonusMessage").textContent = "";
lastHelmetBonus = 0;
lastChainmailBonus = 0;
checkMeals();
}




    function resetCombatFields() {
  document.getElementById('combatSkill').value = '';
  document.getElementById('combatSkillBonus').value = '0';
  document.getElementById('totalCombatSkill').value = '';
  document.getElementById('playerCS').value = ''; // <-- Reset Player Combat Skill
  resetBonusTrackers();
  syncPlayerFields(); // <-- Optional: re-sync if any values are recalculated later
  updateCombatSkillBonus();
  updateCombatSkillMessages();
  
}

function updateTotalCombatSkill() {
  const skill = parseInt(document.getElementById('combatSkill').value) || 0;
  const bonus = parseInt(document.getElementById('combatSkillBonus').value) || 0;
  document.getElementById('totalCombatSkill').value = skill + bonus;
  syncPlayerFields(); // <- add this
}

   function randomizeEndurancePoints() {
  const min = 20;
  const max = 29;
  const value = Math.floor(Math.random() * (max - min + 1)) + min;
  document.getElementById('endurancePoints').value = value;
  updateTotalEndurancePoints();
}

function adjustEnduranceBonus(delta) {
  const field = document.getElementById('enduranceBonus');
  let value = parseInt(field.value) || 0;
  field.value = value + delta;
  updateTotalEndurancePoints();
}

function updateTotalEndurancePoints() {
  const points = parseInt(document.getElementById('endurancePoints').value) || '';
  const bonus = parseInt(document.getElementById('enduranceBonus').value) || '';
  document.getElementById('totalEndurancePoints').value = points + bonus;
  setInitialCurrentEndurance();
  syncPlayerFields();
}

function adjustCurrentEndurancePoints(change) {
  const field = document.getElementById('currentEndurancePoints');
  let value = parseInt(field.value) || 0;
  value += change;
  if (value < 0) value = 0; // prevent negative values
  field.value = value;
  syncPlayerFields(); // <- add this
}

function resetEnduranceFields() {
  // Clear endurance inputs
  document.getElementById('endurancePoints').value = '';
  document.getElementById('enduranceBonus').value = '0';
  document.getElementById('totalEndurancePoints').value = '';

  // Clear any endurance bonus message
  const enduranceMsg = document.getElementById('enduranceBonusMessage');
  if (enduranceMsg) {
    enduranceMsg.textContent = '';
  }

  // Reset your global tracking variable for endurance bonus
  lastEnduranceBonus = 0;

  // Call your initial setup functions
  setInitialCurrentEndurance();

  // Recalculate and update bonuses and totals
  updateEnduranceBonus();
  updateTotalEndurancePoints();
}


  const disciplines = [
    "Camouflage",
    "Hunting - No need for a meal when instructed to eat",
    "Sixth Sense",
    "Healing - +1 Endurance point for each section without combat",
    "Weaponskill - +2 points to Combat skill when carrying skill weapon",
    "Mindshield - No points lost when attacked by Mindblast",
    "Mindblast - +2 Combat Skill points",
    "Animal Kinship",
    "Mind Over Matter"
  ];

  function updateAvailableOptions() {
    const selects = document.querySelectorAll('#kaiDisciplinesSection select');
    const selectedValues = Array.from(selects).map(select => select.value);

    selects.forEach(select => {
      const options = select.querySelectorAll('option');
      options.forEach(option => {
        if (
          selectedValues.includes(option.value) &&
          option.value !== "-- Select Discipline --" &&
          select.value !== option.value
        ) {
          option.disabled = true;
        } else {
          option.disabled = false;
        }
      });
    });
  }

  function randomizeKaiDisciplines() {
    const availableDisciplines = [...disciplines];
    const shuffled = [];

    for (let i = 0; i < 5; i++) {
      const randomIndex = Math.floor(Math.random() * availableDisciplines.length);
      shuffled.push(availableDisciplines[randomIndex]);
      availableDisciplines.splice(randomIndex, 1);
    }

    for (let i = 1; i <= 5; i++) {
      const select = document.getElementById(`discipline${i}`);
      select.value = shuffled[i - 1];
    }

    updateAvailableOptions();
    checkWeaponskillSelected();
    updateWeaponskillButtonState(); // <--- call this here!
    updateCombatSkillBonus();
    updateCombatSkillMessages();
  }

  // Attach change listeners when page loads
  window.addEventListener('DOMContentLoaded', () => {
    const selects = document.querySelectorAll('#kaiDisciplinesSection select');
    selects.forEach(select => {
      select.addEventListener('change', updateAvailableOptions);
    });
    updateAvailableOptions(); // Initial setup
  });

const weaponskillOptions = [
  "Dagger",
  "Spear",
  "Mace",
  "Short Sword",
  "Warhammer",
  "Sword",
  "Axe",
  "Sword",
  "Quarterstaff",
  "Broadsword"
];

const weaponskillButton = document.getElementById('randomizeWeaponskillBtn');
const weaponskillField = document.getElementById('weaponskillField');

function checkWeaponskillSelected() {
  const selects = document.querySelectorAll('#kaiDisciplinesSection select');
  let enabled = false;
  selects.forEach(select => {
    if (select.value === "Weaponskill - +2 points to Combat skill when carrying skill weapon") {
      enabled = true;
    }
  });
  weaponskillButton.disabled = !enabled;
}

// Randomize weapon and update text field
function randomizeWeaponskill() {
  console.log('Randomize Weaponskill button clicked');
  const randomIndex = Math.floor(Math.random() * weaponskillOptions.length);
  const weapon = weaponskillOptions[randomIndex];
  console.log('Selected weapon:', weapon);
  weaponskillField.value = weapon;
  updateCombatSkillBonus();
  updateCombatSkillMessages();
}


// Attach event listeners
window.addEventListener('DOMContentLoaded', () => {
  // Check initially
  checkWeaponskillSelected();

  // Add change event listeners to disciplines dropdowns
  const selects = document.querySelectorAll('#kaiDisciplinesSection select');
  selects.forEach(select => {
    select.addEventListener('change', checkWeaponskillSelected);
  });

  // Button click listener
  weaponskillButton.addEventListener('click', randomizeWeaponskill);
});

document.getElementById("decreaseGold").addEventListener("click", () => {
  const goldField = document.getElementById("beltPouchGold");
  let value = parseInt(goldField.value, 10) || 0;
  if (value > 0) {
    goldField.value = value - 1;
  }
});

document.getElementById("increaseGold").addEventListener("click", () => {
  const goldField = document.getElementById("beltPouchGold");
  let value = parseInt(goldField.value, 10) || 0;
  if (value < 50) {
    goldField.value = value + 1;
  }
});


document.getElementById('randomizeGoldBtn').addEventListener('click', () => {
  const goldField = document.getElementById('beltPouchGold');
  const randomGold = Math.floor(Math.random() * 10); // 0 to 9
  goldField.value = randomGold;
});

const mealsInput = document.getElementById('meals');
const decreaseMealsBtn = document.getElementById('decreaseMealsBtn');
const increaseMealsBtn = document.getElementById('increaseMealsBtn');

decreaseMealsBtn.addEventListener('click', () => {
  let currentValue = parseInt(mealsInput.value) || 0;
  if (currentValue > 0) {  // optionally prevent negative values
    mealsInput.value = currentValue - 1;
  }
  checkMeals();
});

increaseMealsBtn.addEventListener('click', () => {
  let currentValue = parseInt(mealsInput.value) || 0;
  mealsInput.value = currentValue + 1;
  checkMeals();
});

function checkMeals() {
  const mealsField = document.getElementById("meals");
  const warning = document.getElementById("mealsWarning");

  const value = parseInt(mealsField.value, 10) || 0;

  if (value === 0) {
    warning.style.display = "block";
  } else {
    warning.style.display = "none";
  }
}

const discoveredItems = [
  "Sword",
  "Helmet (+2 Endurance Bonus)",
  "Two Meals",
  "Chainmail Waistcoat (+4 Endurance Bonus)",
  "Mace",
  "Healing Potion (+4 Endurance when used)",
  "Quarterstaff",
  "Spear",
  "12 Gold Crowns",
  "Broadsword"
];

document.getElementById('randomizeDiscoveredItemBtn').addEventListener('click', () => {
  const randomIndex = Math.floor(Math.random() * discoveredItems.length);
  document.getElementById('discoveredItem').value = discoveredItems[randomIndex];
});

function updateWeaponskillButtonState() {
  const disciplines = [];
  for (let i = 1; i <= 5; i++) {
    disciplines.push(document.getElementById(`discipline${i}`).value);
  }

  const hasWeaponskill = disciplines.includes("Weaponskill - +2 points to Combat skill when carrying skill weapon");
  const randomizeBtn = document.getElementById("randomizeWeaponskillBtn");

  // Check if randomizeLocked is true (global variable), and disable button accordingly
  if (randomizeLocked || !hasWeaponskill) {
    randomizeBtn.disabled = true;
  } else {
    randomizeBtn.disabled = false;
  }

  if (!hasWeaponskill) {
    document.getElementById("weaponskillField").value = "-";
  }
}

// Attach change listeners to discipline dropdowns
for (let i = 1; i <= 5; i++) {
  const select = document.getElementById(`discipline${i}`);
  select.addEventListener('change', updateWeaponskillButtonState);
}


const CRT = {
  "-11": [["0", "K"], ["0", "K"], ["0", "8"], ["0", "8"], ["1", "7"], ["2", "6"], ["3", "5"], ["4", "4"], ["5", "3"], ["6", "0"]],
  "-10": [["0", "K"], ["0", "8"], ["0", "7"], ["1", "7"], ["2", "6"], ["3", "6"], ["4", "5"], ["5", "4"], ["6", "3"], ["7", "0"]],
  "-8":  [["0", "8"], ["0", "7"], ["1", "6"], ["2", "6"], ["3", "5"], ["4", "5"], ["5", "4"], ["6", "3"], ["7", "2"], ["8", "0"]],
  "-6":  [["0", "6"], ["1", "6"], ["2", "5"], ["3", "5"], ["4", "4"], ["5", "4"], ["6", "3"], ["7", "2"], ["8", "0"], ["9", "0"]],
  "-4":  [["1", "6"], ["2", "5"], ["3", "5"], ["4", "4"], ["5", "4"], ["6", "3"], ["7", "2"], ["8", "1"], ["9", "0"], ["10", "0"]],
  "-2":  [["2", "5"], ["3", "5"], ["4", "4"], ["5", "4"], ["6", "3"], ["7", "2"], ["8", "2"], ["9", "1"], ["10", "0"], ["11", "0"]],
  "0":   [["3", "5"], ["4", "4"], ["5", "4"], ["6", "3"], ["7", "2"], ["8", "2"], ["9", "1"], ["10", "0"], ["11", "0"], ["12", "0"]],
  "2":   [["4", "5"], ["5", "4"], ["6", "3"], ["7", "3"], ["8", "2"], ["9", "2"], ["10", "1"], ["11", "0"], ["12", "0"], ["14", "0"]],
  "4":   [["5", "4"], ["6", "3"], ["7", "3"], ["8", "2"], ["9", "2"], ["10", "2"], ["11", "1"], ["12", "0"], ["14", "0"], ["16", "0"]],
  "6":   [["6", "4"], ["7", "3"], ["8", "3"], ["9", "2"], ["10", "2"], ["11", "1"], ["12", "0"], ["14", "0"], ["16", "0"], ["18", "0"]],
  "8":   [["7", "4"], ["8", "3"], ["9", "2"], ["10", "2"], ["11", "2"], ["12", "1"], ["14", "0"], ["16", "0"], ["18", "0"], ["K", "0"]],
  "10":  [["8", "3"], ["9", "3"], ["10", "2"], ["11", "2"], ["12", "2"], ["14", "1"], ["16", "0"], ["18", "0"], ["K", "0"], ["K", "0"]],
  "12":  [["9", "3"], ["10", "2"], ["11", "2"], ["12", "2"], ["14", "1"], ["16", "1"], ["18", "0"], ["K", "0"], ["K", "0"], ["K", "0"]]
};


// Global state
let combatState = {
  playerCS: 0,
  playerEND: 0,
  startingPlayerEND: 0,
  enemyCS: 0,
  enemyEND: 0,
  round: 1,
  active: false,
};

function getCRTResult(csRatio, rand) {

  let rollIndex;
  if (rand === 0) {
    rollIndex = 9;
  } else {
    rollIndex = rand - 1;
  }
  
  
  let key;
  if (csRatio <= -11) key = "-11";
  else if (csRatio <= -10) key = "-10";
  else if (csRatio <= -8) key = "-8";
  else if (csRatio <= -6) key = "-6";
  else if (csRatio <= -4) key = "-4";
  else if (csRatio <= -2) key = "-2";
  else if (csRatio <= 0) key = "0";
  else if (csRatio <= 2) key = "2";
  else if (csRatio <= 4) key = "4";
  else if (csRatio <= 6) key = "6";
  else if (csRatio <= 8) key = "8";
  else if (csRatio <= 10) key = "10";
  else key = "12";
  
  
  
  return CRT[key][rollIndex];
}

function fightRound() {
  // If combat hasn't been initialized yet, do it
  if (!combatState.active) {
    combatState.playerCS = parseInt(document.getElementById("playerCS").value);
    combatState.playerEND = parseInt(document.getElementById("playerEND").value);
    combatState.enemyCS = parseInt(document.getElementById("enemyCS").value);
    combatState.enemyEND = parseInt(document.getElementById("enemyEND").value);
    combatState.startingPlayerEND = combatState.playerEND;
    combatState.round = 1;

    if (
      isNaN(combatState.playerCS) ||
      isNaN(combatState.playerEND) ||
      isNaN(combatState.enemyCS) ||
      isNaN(combatState.enemyEND)
    ) {
      alert("Please fill in all fields with valid numbers.");
      return;
    }

    document.getElementById("combat-log").innerText = "";
    combatState.active = true;
  }

  if (!combatState.active) return;

  let rand = Math.floor(Math.random() * 10);
  let csRatio = combatState.playerCS - combatState.enemyCS;
  const [enemyLoss, playerLoss] = getCRTResult(csRatio, rand);

  const log = [];

  log.push(`Round ${combatState.round}:`);
  log.push(`Combat Ratio: ${csRatio}, Random Number: ${rand}`);

  if (enemyLoss === "K") {
    combatState.enemyEND = 0;
    log.push("Enemy is instantly killed!");
  } else {
    combatState.enemyEND -= parseInt(enemyLoss);
    log.push(`Enemy loses ${enemyLoss} Endurance Points (Remaining: ${Math.max(0, combatState.enemyEND)})`);
  }

  if (playerLoss === "K") {
    combatState.playerEND = 0;
    log.push("Lone Wolf is instantly killed!");
  } else {
    combatState.playerEND -= parseInt(playerLoss);
    log.push(`Lone Wolf loses ${playerLoss} Endurance Points (Remaining: ${Math.max(0, combatState.playerEND)})`);
  }

document.getElementById("currentEndurancePoints").value = Math.max(0, combatState.playerEND);

  if (combatState.playerEND <= 0 && combatState.enemyEND <= 0) {
    log.push("Both Lone Wolf and the enemy have fallen!");
    combatState.active = false;
  } else if (combatState.playerEND <= 0) {
    log.push("Lone Wolf has been defeated.");
    combatState.active = false;
  } else if (combatState.enemyEND <= 0) {
    log.push("Enemy defeated!");
    const lost = combatState.startingPlayerEND - combatState.playerEND;
    log.push(`Lone Wolf survived, losing ${lost} Endurance Points in total.`);
    combatState.active = false;
  }

  combatState.round++;
  document.getElementById("combat-log").innerText += log.join("\n") + "\n\n";

  // Disable button if combat is over
  if (!combatState.active) {
    document.getElementById("fightBtn").disabled = true;
  }
}

function resetCombat() {
  // Read current player stats from inputs
  const currentCS = parseInt(document.getElementById("playerCS").value);
  const currentEND = parseInt(document.getElementById("currentEndurancePoints").value);

  // Apply them to the main player input fields
  document.getElementById("playerCS").value = isNaN(currentCS) ? "" : currentCS;
  document.getElementById("playerEND").value = isNaN(currentEND) ? "" : currentEND;

  // Clear enemy fields and log
  document.getElementById("enemyCS").value = "";
  document.getElementById("enemyEND").value = "";
  document.getElementById("combat-log").innerText = "";

  // Set the endurance field to match playerEND for consistency
  document.getElementById("currentEndurancePoints").value = isNaN(currentEND) ? "" : currentEND;

  // Reset combat state
  combatState = {
    playerCS: isNaN(currentCS) ? 0 : currentCS,
    playerEND: isNaN(currentEND) ? 0 : currentEND,
    startingPlayerEND: 0,
    enemyCS: 0,
    enemyEND: 0,
    round: 1,
    active: false,
    initialPlayerCS: 0,
    initialPlayerEND: 0
  };

  // Re-enable the fight button
  document.getElementById("fightBtn").disabled = false;
}

function setInitialCurrentEndurance() {
  const total = parseInt(document.getElementById('totalEndurancePoints').value);
  document.getElementById('currentEndurancePoints').value = isNaN(total) ? '' : total;
}

 function syncPlayerFields() {
    const totalCS = document.getElementById("totalCombatSkill");
    const playerCS = document.getElementById("playerCS");
    if (totalCS && playerCS) playerCS.value = totalCS.value;

    const currentEP = document.getElementById("currentEndurancePoints");
    const playerEND = document.getElementById("playerEND");
    if (currentEP && playerEND) playerEND.value = currentEP.value;
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("totalCombatSkill")?.addEventListener("input", syncPlayerFields);
    document.getElementById("currentEndurancePoints")?.addEventListener("input", syncPlayerFields);
    syncPlayerFields(); // sync once on load
  });

function updateCombatSkillBonus() {
  const leftWeapon = document.getElementById("leftHand").value.toLowerCase();
  const rightWeapon = document.getElementById("rightHand").value.toLowerCase();
  const weaponskillWeapon = document.getElementById("weaponskillField").value.toLowerCase();

  const bonusField = document.getElementById("combatSkillBonus");
  let currentBonus = parseInt(bonusField.value, 10) || 0;

  // Remove previously applied bonuses
  currentBonus -= lastUnarmedBonus;
  currentBonus -= lastWeaponskillBonus;
  currentBonus -= lastMindblastBonus;

  // Reset previous bonus values
  lastUnarmedBonus = 0;
  lastWeaponskillBonus = 0;
  lastMindblastBonus = 0;

  const isUnarmed = leftWeapon === "none" && rightWeapon === "none";
  const hasWeaponskill = weaponskillWeapon !== "" &&
                         (leftWeapon === weaponskillWeapon || rightWeapon === weaponskillWeapon);

  if (isUnarmed) {
    lastUnarmedBonus = -4;
    currentBonus += lastUnarmedBonus;
  }

  if (!isUnarmed && hasWeaponskill) {
    lastWeaponskillBonus = 2;
    currentBonus += lastWeaponskillBonus;
  }

  const disciplineFields = document.querySelectorAll(".discipline-field");
  for (const field of disciplineFields) {
    if (field.value === "Mindblast - +2 Combat Skill points") {
      lastMindblastBonus = 2;
      currentBonus += lastMindblastBonus;
      break;
    }
  }

  bonusField.value = currentBonus;

  if (typeof updateTotalCombatSkill === 'function') {
    updateTotalCombatSkill();
  }

}


function updateCombatSkillMessages() {
  const leftWeapon = document.getElementById("leftHand").value.toLowerCase();
  const rightWeapon = document.getElementById("rightHand").value.toLowerCase();
  const weaponskillWeapon = document.getElementById("weaponskillField").value.toLowerCase();

  const unarmedMsg = document.getElementById("unarmedMessage");
  const wsMsg = document.getElementById("weaponskillMessage");
  const mindblastMsg = document.getElementById("mindblastMessage");

  // Clear previous messages
  unarmedMsg.textContent = "";
  wsMsg.textContent = "";
  mindblastMsg.textContent = "";

  const isUnarmed = leftWeapon === "none" && rightWeapon === "none";
  const hasWeaponskill = weaponskillWeapon !== "" &&
                         (leftWeapon === weaponskillWeapon || rightWeapon === weaponskillWeapon);

  if (isUnarmed) {
    unarmedMsg.textContent = "-4 Combat Skill Bonus from being unarmed";
  }

  if (!isUnarmed && hasWeaponskill) {
    wsMsg.textContent = "+2 Combat Skill Bonus from Weaponskill";
  }

  const disciplineFields = document.querySelectorAll(".discipline-field");
  for (const field of disciplineFields) {
    if (field.value === "Mindblast - +2 Combat Skill points") {
      mindblastMsg.textContent = "+2 Combat Skill Bonus from Mindblast";
      break;
    }
  }
}


function updateEnduranceBonus() {
  const discoveredItem = document.getElementById('discoveredItem').value.trim();
  const enduranceBonusField = document.getElementById('enduranceBonus');

  let currentBonus = parseInt(enduranceBonusField.value, 10) || 0;

  // Remove previous bonus
  currentBonus -= lastEnduranceBonus;
  lastEnduranceBonus = 0;

  // Assign new bonus
  if (discoveredItem === "Helmet (+2 Endurance Bonus)") {
    lastEnduranceBonus = 2;
  } else if (discoveredItem === "Chainmail Waistcoat (+4 Endurance Bonus)") {
    lastEnduranceBonus = 4;
  }

  if (lastEnduranceBonus !== 0) {
    currentBonus += lastEnduranceBonus;
  }

  enduranceBonusField.value = currentBonus;

  // üëâ Call the message update function separately
  updateEnduranceBonusMessage(discoveredItem);

  if (typeof updateTotalEndurancePoints === "function") {
    updateTotalEndurancePoints();
  }
}


function updateEnduranceBonusMessage(discoveredItem) {
  const enduranceMsg = document.getElementById('enduranceBonusMessage');
  let message = '';

  if (discoveredItem === "Helmet (+2 Endurance Bonus)") {
    message = "+2 Endurance Bonus from Helmet";
  } else if (discoveredItem === "Chainmail Waistcoat (+4 Endurance Bonus)") {
    message = "+4 Endurance Bonus from Chainmail Waistcoat";
  }

  enduranceMsg.textContent = message;
}


document.addEventListener('DOMContentLoaded', () => {
  // Attach endurance bonus listeners
  const discoveredItemField = document.getElementById('discoveredItem');
  const randomizeBtn = document.getElementById('randomizeDiscoveredItemBtn');

  if (discoveredItemField) {
    // Change event for select elements is more appropriate than input
    discoveredItemField.addEventListener('change', updateEnduranceBonus);
  }

  if (randomizeBtn && discoveredItemField) {
    randomizeBtn.addEventListener('click', () => {
      const discoveredItems = [
        "Sword",
        "Helmet (+2 Endurance Bonus)",
        "Two Meals",
        "Chainmail Waistcoat (+4 Endurance Bonus)",
        "Mace",
        "Healing Potion (+4 Endurance when used)",
        "Quarterstaff",
        "Spear",
        "12 Gold Crowns",
        "Broadsword"
      ];
      const randomIndex = Math.floor(Math.random() * discoveredItems.length);
      discoveredItemField.value = discoveredItems[randomIndex];
      updateEnduranceBonus();
    });
  }

  // Attach event listeners to your select fields and weaponskill input
 

const leftHand = document.getElementById("leftHand");
if (leftHand) {
  leftHand.addEventListener("change", () => {
    updateCombatSkillBonus();
    updateCombatSkillMessages();
  });
}

 

const rightHand = document.getElementById("rightHand");
if (rightHand) {
  rightHand.addEventListener("change", () => {
    updateCombatSkillBonus();
    updateCombatSkillMessages();
  });
}

  const weaponskillField = document.getElementById("weaponskillField");
  if (weaponskillField) weaponskillField.addEventListener("input", updateCombatSkillBonus);

  // Attach event listeners to discipline selects
for (let i = 1; i <= 5; i++) {
  const select = document.getElementById(`discipline${i}`);
  if (select) {
    select.addEventListener('change', () => {
      updateCombatSkillBonus();
      updateCombatSkillMessages();  // üëà Add this here
    });
  }
}
});

const lockButton = document.getElementById("lockRandomizeBtn");

// List all randomize buttons by their IDs
const randomizeButtons = [
  "randomizeWeaponskillBtn",
  "randomizeGoldBtn",
  "randomizeDiscoveredItemBtn",
  "resetCombatBtn",
  "resetEnduranceBtn",
  "restformbtn"
];

// Also include unnamed buttons with onclick handlers
const otherRandomizeButtons = document.querySelectorAll('button[onclick^="randomize"]');

const disciplineDropdowns = document.querySelectorAll(".discipline-field");

let randomizeLocked = false;

// üîÅ Toggle function
function toggleRandomizeLock() {
  setRandomizeLockState(!randomizeLocked);
}

// ‚úÖ Set state explicitly
function setRandomizeLockState(locked) {
  randomizeLocked = locked;

  // Update the lock button appearance and text
  if (randomizeLocked) {
    lockButton.textContent = "Unlock Form";
    lockButton.style.backgroundColor = "darkgray";
    lockButton.style.color = "white";
    lockButton.classList.add("locked"); // for saving
  } else {
    lockButton.textContent = "Lock Form";
    lockButton.style.backgroundColor = "";
    lockButton.style.color = "";
    lockButton.classList.remove("locked");
  }

  // Disable or enable named randomize buttons
  randomizeButtons.forEach(id => {
    const btn = document.getElementById(id);
    if (btn) btn.disabled = randomizeLocked;
  });

  // Disable or enable other buttons with inline onclick
  otherRandomizeButtons.forEach(btn => {
    btn.disabled = randomizeLocked;
  });
  
  // Disable or enable discipline dropdowns
  disciplineDropdowns.forEach(dropdown => {
    dropdown.disabled = randomizeLocked;
  });
}

// üí° Button click toggles lock state
lockButton.addEventListener("click", toggleRandomizeLock);

const notes = document.getElementById('notes');

function autoResizeTextarea(textarea) {
  textarea.style.height = 'auto'; // reset any previously set height
  textarea.style.height = textarea.scrollHeight + 'px'; // expand to fit content
}

notes.addEventListener('input', function () {
  this.style.height = 'auto'; // reset height
  this.style.height = (this.scrollHeight) + 'px'; // set new height
});

  </script>
</body>
</html>
